<!DOCTYPE html><html><head>
      <title>SVM_DOCUMENTATION</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\feded\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.8.15\crossnote\dependencies\katex\katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="documentación-del-modelo-de-ia-para-diagnóstico-médico">Documentación del Modelo de IA para Diagnóstico Médico </h1>
<hr>
<h2 id="introducción">Introducción </h2>
<p>Este proyecto tiene como objetivo desarrollar una aplicación de inteligencia artificial para realizar diagnósticos médicos a través de imágenes de rayos X del torso. La aplicación web (MEDILAB) utiliza un modelo de IA entrenado específicamente para analizar estas imágenes y determinar si un paciente se encuentra en estado normal o si presenta signos de de alguna enfermedad. Este modelo en particular está entrenado para clasificar personas en estado de salud <strong>normal</strong> y personas con <strong>neumonía</strong>.</p>
<p>El modelo de IA fue entrenado utilizando un <strong>Support Vector Machine (SVM)</strong> con kernel lineal, el cual es adecuado para este tipo de clasificación binaria. La elección de un SVM permite que el modelo encuentre un hiperplano que maximice la separación entre las clases normal y neumonía, asegurando así un diagnóstico preciso. El modelo fue configurado con <code>probability=True</code> para obtener no solo la predicción de clase, sino también la probabilidad asociada a cada predicción, lo cual es crucial para proporcionar un nivel de confianza en los diagnósticos.</p>
<p>A lo largo del desarrollo de este proyecto, se realizaron múltiples análisis y evaluaciones para asegurar la precisión y la confiabilidad del modelo. La documentación detalla los pasos y decisiones clave en el proceso de entrenamiento, validación y pruebas, proporcionando una visión clara del funcionamiento y las capacidades del modelo.</p>
<h2 id="montaje-de-google-drive">Montaje de Google Drive </h2>
<p>Para facilitar el acceso a los datos, se monta Google Drive en el entorno de Colab, permitiendo leer las imágenes de rayos X almacenadas en la carpeta de Drive configurada para este proyecto.</p>
<h2 id="lectura-y-preprocesamiento-de-imágenes">Lectura y Preprocesamiento de Imágenes </h2>
<p>Para entrenar el modelo, es esencial que todas las imágenes tengan el mismo tamaño y formato. Las imágenes en el dataset están redimensionadas a <code>512x512</code> píxeles para que sean uniformes y convertidas a escala de grises. Luego, cada imagen se convierte en un vector unidimensional para poder ser procesada por el modelo.</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code>IMG_SIZE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">)</span>
</code></pre><p>La función <code>load_images_from_folder</code> toma como entrada la carpeta y una etiqueta (0 para NORMAL y 1 para PNEUMONIA) y devuelve dos listas: una con las imágenes convertidas a vectores y otra con las etiquetas correspondientes.<br>
En el caso de este entrenamiento, se utilizó un tamaño de imagen de <code>512x512</code> píxeles, el vector resultante unidimencional perteneciente a esa imagen tendrá un tamaño de <code>262.144</code> elementos.</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code><span class="token keyword keyword-def">def</span> <span class="token function">load_images_from_folder</span><span class="token punctuation">(</span>folder<span class="token punctuation">,</span> label<span class="token punctuation">)</span><span class="token punctuation">:</span>
    images <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword keyword-for">for</span> filename <span class="token keyword keyword-in">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>folder<span class="token punctuation">)</span><span class="token punctuation">:</span>
        img_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>folder<span class="token punctuation">,</span> filename<span class="token punctuation">)</span>
        <span class="token keyword keyword-try">try</span><span class="token punctuation">:</span>
            img <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>img_path<span class="token punctuation">)</span><span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">'L'</span><span class="token punctuation">)</span>  <span class="token comment"># Convertir a escala de grises</span>
            img <span class="token operator">=</span> img<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>IMG_SIZE<span class="token punctuation">)</span>  <span class="token comment"># Redimensionar las imágenes</span>
            img_array <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># Convertir la imagen a un vector 1D</span>
            images<span class="token punctuation">.</span>append<span class="token punctuation">(</span>img_array<span class="token punctuation">)</span>
            labels<span class="token punctuation">.</span>append<span class="token punctuation">(</span>label<span class="token punctuation">)</span>
        <span class="token keyword keyword-except">except</span> Exception <span class="token keyword keyword-as">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword keyword-print">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Error al procesar </span><span class="token interpolation"><span class="token punctuation">{</span>filename<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-return">return</span> images<span class="token punctuation">,</span> labels
</code></pre><p>Esta función retorna dos listas para el <code>folder</code> pasado como parámetro:</p>
<ul>
<li><code>normal_images</code> y <code>pneumonia_images</code>: listas que contienen las imágenes como arrays unidimensionales.</li>
<li><code>normal_labels</code> y <code>pneumonia_labels</code>: listas de etiquetas binarias que corresponden a cada imagen (0 para NORMAL y 1 para PNEUMONIA).</li>
</ul>
<h3 id="asignación-de-etiquetas-y-combinación-de-datos">Asignación de Etiquetas y Combinación de Datos </h3>
<p>Las imágenes se agrupan en dos clases con sus respectivas etiquetas binarias, (<code>0</code>) <strong>NORMAL</strong> y (<code>1</code>) <strong>PNEUMONIA</strong>. Posteriormente, las imágenes y etiquetas de ambas clases se combinan en una única lista, que se convierte a arrays de NumPy para su procesamiento por el modelo.</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code>normal_images<span class="token punctuation">,</span> normal_labels <span class="token operator">=</span> load_images_from_folder<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>dataset_path<span class="token punctuation">,</span> <span class="token string">'NORMAL'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
pneumonia_images<span class="token punctuation">,</span> pneumonia_labels <span class="token operator">=</span> load_images_from_folder<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>dataset_path<span class="token punctuation">,</span> <span class="token string">'PNEUMONIA'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre><h3 id="combinar-las-imágenes-y-las-etiquetas">Combinar las imágenes y las etiquetas </h3>
<p>Se concatenan las listas normal_images y pneumonia_images en una sola lista X, que contiene todas las imágenes del dataset. Análogamente con las labels.</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code>X <span class="token operator">=</span> normal_images <span class="token operator">+</span> pneumonia_images
y <span class="token operator">=</span> normal_labels <span class="token operator">+</span> pneumonia_labels
</code></pre><h2 id="conversión-a-arrays-de-numpy">Conversión a Arrays de NumPy </h2>
<p>Las listas combinadas <code>X</code> e <code>y</code> se convierten en arrays de NumPy. Esto es importante para que los datos sean compatibles con las operaciones que se realizarán en el entrenamiento del modelo.</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code>X <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>X<span class="token punctuation">)</span>
y <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>y<span class="token punctuation">)</span>
</code></pre><h2 id="separación-en-conjuntos-de-entrenamiento-y-validación">Separación en Conjuntos de Entrenamiento y Validación </h2>
<p>Para evaluar el rendimiento del modelo, se divide el conjunto de datos en un 80% para entrenamiento y un 20% para validación. Esto se realiza utilizando <code>train_test_split</code> con una semilla (<code>random_state=42</code>).</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code>X_train<span class="token punctuation">,</span> X_val<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_val <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>
</code></pre><h2 id="entrenamiento">Entrenamiento </h2>
<p>Se entrena un modelo de clasificación SVM (Support Vector Machine) con kernel lineal, y se evalúa su rendimiento en el conjunto de validación. Este tipo de kernel es útil cuando los datos son linealmente separables.<br>
Para entrenar el modelo, utilizamos SVC de la biblioteca scikit-learn. Este modelo SVM es adecuado para problemas de clasificación binaria, como en este caso, donde el objetivo es clasificar las imágenes en una de dos categorías: "Normal" o "Neumonía"</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code>svm_model <span class="token operator">=</span> SVC<span class="token punctuation">(</span>kernel<span class="token operator">=</span><span class="token string">'linear'</span><span class="token punctuation">,</span> probability<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
svm_model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
</code></pre><p><code>SVC</code> significa <strong>Support Vector Classifier</strong>. Es una implementación específica de SVM en la biblioteca scikit-learn de Python, diseñada específicamente para tareas de clasificación.</p>
<p>Con un algoritmo SVM, se calculará la relación entre cada par de puntos y, finalmente, dibujará el SVC a partir de ahí.</p>
<p><img src="images/example_SVM_img1.jpg" alt="Ejemplo sin clasificar"><br>
<em>Figura 1: Datos de ejemplo sin clasificar.</em></p>
<p>Los puntos se vuelven linealmente separables, ya que podemos dibujar el SVC Lineal óptimo de la siguiente manera:</p>
<p><img src="images/example_SVM_img2.jpg" alt="Ejemplo clasificado"><br>
<em>Figura 2: Clasificación de los datos con SVC Lineal.</em></p>
<p>Fuente: <a href="https://www.stratascratch.com/blog/machine-learning-algorithms-explained-support-vector-machine/">StrataScratch - Machine Learning Algorithms Explained: Support Vector Machine</a></p>
<h2 id="evaluación">Evaluación </h2>
<p>Se evalúa el rendimiento del modelo en el conjunto de validación utilizando métricas de precisión, recall y F1 score, que permiten ver la eficacia del modelo al clasificar entre las clases "NORMAL" y "PNEUMONIA".</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code><span class="token comment"># Predicciones en el conjunto de validación</span>
y_pred <span class="token operator">=</span> svm_model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_val<span class="token punctuation">)</span>

<span class="token comment"># Evaluación del modelo</span>
<span class="token keyword keyword-print">print</span><span class="token punctuation">(</span><span class="token string">"SVM Accuracy:"</span><span class="token punctuation">,</span> accuracy_score<span class="token punctuation">(</span>y_val<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># Precisión general del modelo</span>
<span class="token keyword keyword-print">print</span><span class="token punctuation">(</span>classification_report<span class="token punctuation">(</span>y_val<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># Informe detallado con precisión, recall y F1 score</span>
</code></pre><p><img src="images/svm_val_evaluation.jpg" alt="Estadisticas"><br>
<em>Figura 3: Informe detallado con presicion, recall, f1 score para ambas clases.</em></p>
<h2 id="predicciones-con-probabilidades-en-el-conjunto-de-validación">Predicciones con Probabilidades en el Conjunto de Validación </h2>
<p>Como una característica de nuestro servicio, se obtienen las probabilidades de pertenencia a cada clase para las predicciones en el conjunto de validación, lo que permite observar con qué grado de confianza el modelo clasifica cada caso como <strong>NORMAL</strong> o <strong>PNEUMONIA</strong>.</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code><span class="token comment"># Predicciones con probabilidades en el conjunto de validación</span>
y_pred_proba <span class="token operator">=</span> svm_model<span class="token punctuation">.</span>predict_proba<span class="token punctuation">(</span>X_val<span class="token punctuation">)</span>  <span class="token comment"># Devuelve las probabilidades para cada clase</span>

<span class="token comment"># Mostrar las primeras predicciones con sus porcentajes de confianza</span>
<span class="token keyword keyword-for">for</span> i <span class="token keyword keyword-in">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># Muestra solo las primeras 5 como ejemplo</span>
    <span class="token keyword keyword-print">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Predicción: </span><span class="token interpolation"><span class="token punctuation">{</span>y_pred<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">, Probabilidad de clase 0 (normal): </span><span class="token interpolation"><span class="token punctuation">{</span>y_pred_proba<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">, Probabilidad de clase 1 (neumonía): </span><span class="token interpolation"><span class="token punctuation">{</span>y_pred_proba<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
</code></pre><h2 id="predicciones-con-probabilidades">Predicciones con probabilidades </h2>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>Predicciones acertadas - Clase Normal:
Etiqueta real: Normal, Predicción: Normal, Probabilidad de clase <span class="token number">0</span> <span class="token punctuation">(</span>Normal<span class="token punctuation">)</span>: <span class="token number">99.90</span>%, Probabilidad de clase <span class="token number">1</span> <span class="token punctuation">(</span>Neumonía<span class="token punctuation">)</span>: <span class="token number">0.10</span>%
Etiqueta real: Normal, Predicción: Normal, Probabilidad de clase <span class="token number">0</span> <span class="token punctuation">(</span>Normal<span class="token punctuation">)</span>: <span class="token number">85.80</span>%, Probabilidad de clase <span class="token number">1</span> <span class="token punctuation">(</span>Neumonía<span class="token punctuation">)</span>: <span class="token number">14.20</span>%
Etiqueta real: Normal, Predicción: Normal, Probabilidad de clase <span class="token number">0</span> <span class="token punctuation">(</span>Normal<span class="token punctuation">)</span>: <span class="token number">100.00</span>%, Probabilidad de clase <span class="token number">1</span> <span class="token punctuation">(</span>Neumonía<span class="token punctuation">)</span>: <span class="token number">0.00</span>%
Etiqueta real: Normal, Predicción: Normal, Probabilidad de clase <span class="token number">0</span> <span class="token punctuation">(</span>Normal<span class="token punctuation">)</span>: <span class="token number">76.25</span>%, Probabilidad de clase <span class="token number">1</span> <span class="token punctuation">(</span>Neumonía<span class="token punctuation">)</span>: <span class="token number">23.75</span>%
Etiqueta real: Normal, Predicción: Normal, Probabilidad de clase <span class="token number">0</span> <span class="token punctuation">(</span>Normal<span class="token punctuation">)</span>: <span class="token number">56.67</span>%, Probabilidad de clase <span class="token number">1</span> <span class="token punctuation">(</span>Neumonía<span class="token punctuation">)</span>: <span class="token number">43.33</span>%

Predicciones acertadas - Clase Neumonía:
Etiqueta real: Neumonía, Predicción: Neumonía, Probabilidad de clase <span class="token number">0</span> <span class="token punctuation">(</span>Normal<span class="token punctuation">)</span>: <span class="token number">0.87</span>%, Probabilidad de clase <span class="token number">1</span> <span class="token punctuation">(</span>Neumonía<span class="token punctuation">)</span>: <span class="token number">99.13</span>%
Etiqueta real: Neumonía, Predicción: Neumonía, Probabilidad de clase <span class="token number">0</span> <span class="token punctuation">(</span>Normal<span class="token punctuation">)</span>: <span class="token number">18.15</span>%, Probabilidad de clase <span class="token number">1</span> <span class="token punctuation">(</span>Neumonía<span class="token punctuation">)</span>: <span class="token number">81.85</span>%
Etiqueta real: Neumonía, Predicción: Neumonía, Probabilidad de clase <span class="token number">0</span> <span class="token punctuation">(</span>Normal<span class="token punctuation">)</span>: <span class="token number">0.00</span>%, Probabilidad de clase <span class="token number">1</span> <span class="token punctuation">(</span>Neumonía<span class="token punctuation">)</span>: <span class="token number">100.00</span>%
Etiqueta real: Neumonía, Predicción: Neumonía, Probabilidad de clase <span class="token number">0</span> <span class="token punctuation">(</span>Normal<span class="token punctuation">)</span>: <span class="token number">38.94</span>%, Probabilidad de clase <span class="token number">1</span> <span class="token punctuation">(</span>Neumonía<span class="token punctuation">)</span>: <span class="token number">61.06</span>%

Predicciones fallidas - Clase Normal:
Etiqueta real: Normal, Predicción: Neumonía, Probabilidad de clase <span class="token number">0</span> <span class="token punctuation">(</span>Normal<span class="token punctuation">)</span>: <span class="token number">3.43</span>%, Probabilidad de clase <span class="token number">1</span> <span class="token punctuation">(</span>Neumonía<span class="token punctuation">)</span>: <span class="token number">96.57</span>%
Etiqueta real: Normal, Predicción: Neumonía, Probabilidad de clase <span class="token number">0</span> <span class="token punctuation">(</span>Normal<span class="token punctuation">)</span>: <span class="token number">44.96</span>%, Probabilidad de clase <span class="token number">1</span> <span class="token punctuation">(</span>Neumonía<span class="token punctuation">)</span>: <span class="token number">55.04</span>%

Predicciones fallidas - Clase Neumonía:
Etiqueta real: Neumonía, Predicción: Normal, Probabilidad de clase <span class="token number">0</span> <span class="token punctuation">(</span>Normal<span class="token punctuation">)</span>: <span class="token number">97.28</span>%, Probabilidad de clase <span class="token number">1</span> <span class="token punctuation">(</span>Neumonía<span class="token punctuation">)</span>: <span class="token number">2.72</span>%
Etiqueta real: Neumonía, Predicción: Normal, Probabilidad de clase <span class="token number">0</span> <span class="token punctuation">(</span>Normal<span class="token punctuation">)</span>: <span class="token number">57.93</span>%, Probabilidad de clase <span class="token number">1</span> <span class="token punctuation">(</span>Neumonía<span class="token punctuation">)</span>: <span class="token number">42.07</span>%
</code></pre><h2 id="vizualización-de-imagen">Vizualización de imagen </h2>
<p>Aqui se puede observar una imagen de la clase normal de los datos que toma el modelo para entrenarse. Esta imagen son los <code>512x512</code> píxeles representados nuevamente en una imagen.</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code><span class="token keyword keyword-import">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword keyword-as">as</span> plt
img <span class="token operator">=</span> X<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><p><img src="images/normal_img_representation_from_trained_data.jpg" alt="primer_elemento_claseNormal"><br>
<em>Figura 4: una imagen perteneciente a la clase Normal.</em></p>
<h2 id="cross-validation">Cross-Validation </h2>
<p>Se realiza una validación cruzada para evaluar la estabilidad y rendimiento del modelo SVM. Esto permite comprobar cómo se comporta el modelo con diferentes particiones del conjunto de datos de entrenamiento y obtener una medida más robusta de su precisión.</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code><span class="token keyword keyword-from">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword keyword-import">import</span> cross_val_score

<span class="token comment"># Realizar validación cruzada con 3 particiones</span>
scores <span class="token operator">=</span> cross_val_score<span class="token punctuation">(</span>svm_model<span class="token punctuation">,</span> X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> scoring<span class="token operator">=</span><span class="token string">"accuracy"</span><span class="token punctuation">)</span>
<span class="token keyword keyword-print">print</span><span class="token punctuation">(</span><span class="token string">"Cross-Validation Scores:"</span><span class="token punctuation">,</span> scores<span class="token punctuation">)</span>
<span class="token keyword keyword-print">print</span><span class="token punctuation">(</span><span class="token string">"Mean Accuracy:"</span><span class="token punctuation">,</span> scores<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>Cross-Validation Scores: <span class="token punctuation">[</span><span class="token number">0.95416667</span> <span class="token number">0.95827538</span> <span class="token number">0.9596662</span> <span class="token punctuation">]</span>
Mean Accuracy: <span class="token number">0.9573694174007109</span>
</code></pre><h2 id="evaluación-de-presicion-recall-y-threshold">Evaluación de Presicion, Recall y Threshold </h2>
<p>En esta sección, se vuelve a imprimir el <strong>reporte de clasificación</strong> para analizar los datos junto al <strong>recall</strong> y el <strong>threshold</strong>.</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code><span class="token keyword keyword-print">print</span><span class="token punctuation">(</span><span class="token string">"\nRe-imprimiendo el reporte de clasificación:"</span><span class="token punctuation">)</span>
<span class="token keyword keyword-print">print</span><span class="token punctuation">(</span>classification_report<span class="token punctuation">(</span>y_val<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>Re-imprimiendo el reporte de clasificación:
              precision    recall  f1-score   support

           <span class="token number">0</span>       <span class="token number">0.97</span>      <span class="token number">0.96</span>      <span class="token number">0.97</span>       <span class="token number">281</span>
           <span class="token number">1</span>       <span class="token number">0.95</span>      <span class="token number">0.97</span>      <span class="token number">0.96</span>       <span class="token number">259</span>

    accuracy                           <span class="token number">0.96</span>       <span class="token number">540</span>
   macro avg       <span class="token number">0.96</span>      <span class="token number">0.97</span>      <span class="token number">0.96</span>       <span class="token number">540</span>
weighted avg       <span class="token number">0.97</span>      <span class="token number">0.96</span>      <span class="token number">0.96</span>       <span class="token number">540</span>
</code></pre><h2 id="gráfica-de-precisión-y-recall-en-función-del-threshold">Gráfica de Precisión y Recall en Función del Threshold </h2>
<p>Para comprender mejor el comportamiento del modelo y ajustar el threshold de decisión, se calcula y grafica la relación entre <strong>precisión</strong> y <strong>recall</strong> a medida que varía el threshold. Este gráfico ayuda a visualizar cómo cambia el rendimiento del modelo al exigir mayor confianza para clasificar una instancia como <strong>PNEUMONIA</strong>.</p>
<p><img src="images/precision-recall-vs-threshold.jpg" alt="Gráfico de Precisión y Recall vs Threshold"><br>
<em>Figura 5</em></p>
<p>Este gráfico permite decidir un threshold óptimo que mantenga un buen equilibrio entre precisión y recall, lo cual es crítico en aplicaciones de diagnóstico médico donde se busca minimizar tanto falsos positivos como falsos negativos.</p>
<h2 id="confusion-matrix">Confusion Matrix </h2>
<p><img src="images/confusion_matrix.jpg" alt="Gráfico de Confusion Matrix"><br>
<em>Figura 6</em></p>
<h2 id="comparativa-de-metricas-antes-y-después-del-ajuste-del-threshold">Comparativa de metricas antes y después del ajuste del threshold </h2>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>Reporte de clasificación sin threshold ajustado:
------------------------------------------------
Precisión <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>: <span class="token number">0.9746</span>
Recall <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>: <span class="token number">0.9573</span>
F1 Score <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>: <span class="token number">0.9659</span>

Precisión <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>: <span class="token number">0.9545</span>
Recall <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>: <span class="token number">0.9730</span>
F1 Score <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>: <span class="token number">0.9637</span>
Accuracy: <span class="token number">0.9648</span>

Reporte de clasificación con threshold ajustado:
------------------------------------------------
Precisión <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>: <span class="token number">0.9479</span>
Recall <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>: <span class="token number">0.9715</span>
F1 Score <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>: <span class="token number">0.9596</span>

Precisión <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>: <span class="token number">0.9683</span>
Recall <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>: <span class="token number">0.9421</span>
F1 Score <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>: <span class="token number">0.9550</span>
Accuracy: <span class="token number">0.9574</span>
</code></pre><h2 id="curva-roc-y-auc">Curva ROC y AUC </h2>
<p><img src="images/ROC_curve.jpg" alt="Gráfico de Confusion Matrix"><br>
<em>Figura 7</em></p>
<p><strong>Alta Precisión:</strong> El modelo tiene una alta precisión en la clasificación, lo que implica que tiene un bajo número de falsos positivos y falsos negativos.</p>
<p><strong>Confiabilidad:</strong> confiar en las predicciones del modelo, especialmente si el objetivo es detectar una condición crítica como la neumonía.</p>
<h2 id="guardar-el-modelo-entrenado">Guardar el modelo entrenado </h2>
<p>Una vez entrenado el modelo, es importante guardarlo para su uso futuro sin necesidad de volver a entrenarlo.</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code><span class="token keyword keyword-import">import</span> joblib
<span class="token keyword keyword-from">from</span> google<span class="token punctuation">.</span>colab <span class="token keyword keyword-import">import</span> files

joblib<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>svm_model<span class="token punctuation">,</span> <span class="token string">'trained_model_svm_pneumonia.pkl'</span><span class="token punctuation">)</span>
files<span class="token punctuation">.</span>download<span class="token punctuation">(</span><span class="token string">'trained_model_svm_pneumonia.pkl'</span><span class="token punctuation">)</span>
</code></pre><p>El formato .pkl es un formato de serialización de Python que permite guardar objetos Python en disco.</p>
<h2 id="aclaraciones-importantes">Aclaraciones importantes </h2>
<p>En el análisis del dataset se utilizó una función para detectar <strong>imágenes duplicadas</strong>, con el objetivo de demostrar que existen datos redundantes que afectan negativamente el entrenamiento del modelo. La presencia de duplicados y de posibles <strong>errores de etiquetado</strong> compromete la calidad del dataset.<br>
Esto induce al modelo a aprender patrones que no generalizan correctamente, perjudicando su rendimiento en fases de evaluación y test. Esto evidencia que el dataset no es completamente confiable y puede impactar los resultados de predicción en un entorno real, especialmente en tareas críticas como el diagnóstico médico.</p>
<p><strong>Google colab</strong> fue una herramienta de gran utilidad a la hora de trabajar en el apartado de AI pero utilizamos la version gratuita disponible. Esto fue tambien un problema ya que nos presentamos con conflictos a la hora de entrenar los modelos o en momentos en los que teniamos largas sesiones de trabajo. Se nos terminaba la cuota gratuita o se ocupaba toda la ram disponible para utilizar. En otras palabras, el <strong>poder de computo</strong> fue un problema a la hora del entrenamiento y evaluación de los modelos.</p>
<p>Por otro lado, hoy por hoy es posible subir el modelo entrenado a <strong>Hugging Face</strong> pero no utilizarlo remotamente desde la app web ya que no es el formato ideal para compartir modelos en Hugging Face.</p>
<p>Hugging Face tiene su propio formato para almacenar modelos y recomienda guardar los modelos en formato compatible con PyTorch o TensorFlow.</p>
<p>Migrar el modelo actualmente desarrollado a TensorFlow o Keras implicaría reestructurar varias partes del código, ya que el proceso de modelado, entrenamiento y evaluación es diferente al de scikit-learn.</p>
<p>Entonces se subió el modelo entrenado al repositorio de Hugging Face, luego desde la app se descarga y se utiliza localmente.</p>
<h2 id="conclusión">Conclusión </h2>
<p>Este modelo de diagnóstico basado en un clasificador SVM demuestra una capacidad efectiva para diferenciar entre casos normales y aquellos con neumonía a partir de imágenes de rayos X. A lo largo de esta documentación, se explicó cada paso del proceso, desde la carga y preprocesamiento de los datos hasta el entrenamiento, evaluación y almacenamiento del modelo.</p>
<p>Este enfoque inicial proporciona una herramienta útil para el diagnóstico médico asistido, y se puede expandir y mejorar en futuras versiones.</p>
<p>Este trabajo representa un paso hacia aplicaciones de inteligencia artificial que apoyan a los profesionales de la salud en la detección temprana de enfermedades.</p>
<hr>
<p>Gracias por leer esta documentación.</p>

      </div>
      
      
    
    
    
    
    
    
  
    </body></html>